# 要件文書

## 概要

保有株式の分析を自動化し、Gemini AIを使用して分析結果を生成し、Slackで通知するアプリケーションです。このシステムにより、ユーザーは定期的に株式ポートフォリオの状況を把握し、投資判断に役立つ情報を受け取ることができます。

## 要件

### 要件 1: 株式データ取得

**ユーザーストーリー:** 投資家として、保有している株式の最新データを自動で取得したいので、手動でデータを収集する手間を省きたい

#### 受入基準

1. WHEN システムが起動される THEN システムはGoogle Spreadsheetから保有銘柄リストとウォッチリストを読み込む SHALL
2. WHEN 株式データ取得が実行される THEN システムは各銘柄の現在価格、前日比、出来高を取得する SHALL
3. WHEN データ取得に失敗した場合 THEN システムはエラーログを記録し、利用可能なデータで処理を続行する SHALL
4. WHEN データが正常に取得された場合 THEN システムは取得時刻とともにデータを保存する SHALL

### 要件 1.1: Google Spreadsheet統合

**ユーザーストーリー:** 投資家として、保有銘柄とウォッチリストをGoogle Spreadsheetで管理したいので、使い慣れたツールで銘柄情報を更新できるようにしたい

#### 受入基準

1. WHEN システムが銘柄情報を取得する THEN システムはGoogle Sheets APIを使用してスプレッドシートにアクセスする SHALL
2. WHEN 保有銘柄シートを読み込む THEN システムは銘柄コード、銘柄名、保有数量、購入価格を取得する SHALL
3. WHEN ウォッチリストシートを読み込む THEN システムは監視対象の銘柄コードと銘柄名を取得する SHALL
4. WHEN スプレッドシートの読み込みに失敗した場合 THEN システムはエラーを記録し、前回のキャッシュデータを使用する SHALL
5. WHEN スプレッドシートのデータが更新された場合 THEN システムは次回実行時に新しいデータを反映する SHALL

### 要件 2: AI分析機能

**ユーザーストーリー:** 投資家として、保有株式の専門的な分析を受けたいので、Gemini AIによる洞察を得て投資判断の参考にしたい

#### 受入基準

1. WHEN 株式データが準備完了した場合 THEN システムはGemini APIに分析リクエストを送信する SHALL
2. WHEN 分析リクエストを送信する場合 THEN システムは株価データ、トレンド情報、市場状況を含める SHALL
3. WHEN Gemini APIから応答を受信した場合 THEN システムは分析結果を構造化された形式で保存する SHALL
4. WHEN API呼び出しが失敗した場合 THEN システムは再試行機能を実行し、最大3回まで試行する SHALL
5. WHEN 分析結果が生成された場合 THEN システムは投資推奨、リスク評価、市場見通しを含む SHALL

### 要件 2.1: 日次分析機能

**ユーザーストーリー:** 投資家として、毎日のトレーディング判断に役立つ技術分析を受けたいので、保有銘柄の売買推奨とウォッチリスト銘柄の購入推奨を得たい

#### 受入基準

1. WHEN 日次分析が実行される THEN システムは保有銘柄に対してテクニカル指標に基づく売買推奨を生成する SHALL
2. WHEN 日次分析が実行される THEN システムはウォッチリスト銘柄に対して購入推奨を生成する SHALL
3. WHEN 保有銘柄を分析する THEN システムはゴールデンクロス/デッドクロス（短期MA > 長期MA）を評価する SHALL
4. WHEN 価格分析を行う THEN システムは新高値/新安値ブレイクを検出する SHALL
5. WHEN サポート・レジスタンス分析を行う THEN システムはレジスタンス/サポートライン突破を判定する SHALL
6. WHEN オシレーター分析を行う THEN システムはRSI（買われすぎ/売られすぎ判定）を計算する SHALL
7. WHEN トレンド分析を行う THEN システムはMACD（トレンド転換シグナル）を評価する SHALL
8. WHEN 市場分析を行う THEN システムは市場全体との相関係数を計算する SHALL
9. WHEN 出来高分析を行う THEN システムは出来高の変化率を評価する SHALL
10. WHEN 日次分析が完了した場合 THEN システムは保有銘柄の追加購入・売却アドバイスとウォッチリスト銘柄の購入推奨を提供する SHALL

### 要件 2.2: 週次分析機能

**ユーザーストーリー:** 投資家として、週単位でのポートフォリオパフォーマンスを把握したいので、保有株式の総合的な分析を受けたい

#### 受入基準

1. WHEN 週次分析が実行される THEN システムは保有している全株式のパフォーマンス分析を実行する SHALL
2. WHEN パフォーマンス分析を行う THEN システムは各銘柄の週間リターン、ボラティリティを計算する SHALL
3. WHEN 比較分析を行う THEN システムは各銘柄のベンチマーク（市場指数）との比較を提供する SHALL
4. WHEN 週次分析が完了した場合 THEN システムはポートフォリオ全体のパフォーマンスサマリーを生成する SHALL

### 要件 2.3: 月次分析機能

**ユーザーストーリー:** 投資家として、長期的な投資戦略を見直したいので、国・業種別の分析とリバランス提案を受けたい

#### 受入基準

1. WHEN 月次分析が実行される THEN システムは国別のパフォーマンス分析を実行する SHALL
2. WHEN 業種分析を行う THEN システムは業種ごとのパフォーマンス分析を実行する SHALL
3. WHEN リバランス分析を行う THEN システムは長期的なパフォーマンスに基づくリバランスアドバイスを提供する SHALL
4. WHEN 分散投資分析を行う THEN システムは現在のポートフォリオの分散状況を評価する SHALL
5. WHEN 月次分析が完了した場合 THEN システムは長期投資戦略の見直し提案を生成する SHALL

### 要件 3: Slack通知機能

**ユーザーストーリー:** 投資家として、分析結果をSlackで受け取りたいので、リアルタイムで情報を確認し、チームと共有できるようにしたい

#### 受入基準

1. WHEN 分析が完了した場合 THEN システムはSlack APIを使用して指定チャンネルに通知を送信する SHALL
2. WHEN 通知を送信する場合 THEN システムは分析結果、重要な指標、推奨アクションを含む SHALL
3. WHEN 通知の送信に失敗した場合 THEN システムはエラーを記録し、管理者に警告を送信する SHALL
4. WHEN 通知が正常に送信された場合 THEN システムは送信ログを記録する SHALL
5. WHEN 緊急度の高い分析結果がある場合 THEN システムは特別な書式で通知を送信する SHALL

### 要件 4: 設定管理

**ユーザーストーリー:** システム管理者として、監視する株式銘柄や通知設定を管理したいので、柔軟にシステムをカスタマイズできるようにしたい

#### 受入基準

1. WHEN システムが初期化される THEN システムは設定ファイルから株式銘柄リスト、API設定、通知設定を読み込む SHALL
2. WHEN 設定ファイルが存在しない場合 THEN システムはデフォルト設定でサンプル設定ファイルを作成する SHALL
3. WHEN 設定が変更された場合 THEN システムは次回実行時に新しい設定を適用する SHALL
4. WHEN 無効な設定が検出された場合 THEN システムは警告を表示し、デフォルト値を使用する SHALL

### 要件 5: スケジュール実行

**ユーザーストーリー:** 投資家として、定期的に自動で分析を実行したいので、手動で毎回実行する必要がないようにしたい

#### 受入基準

1. WHEN システムが起動された場合 THEN システムはスケジュール設定に基づいて定期実行を開始する SHALL
2. WHEN 日次スケジュールが実行される THEN システムは平日の市場終了後に日次分析を実行する SHALL
3. WHEN 週次スケジュールが実行される THEN システムは毎週末に週次分析を実行する SHALL
4. WHEN 月次スケジュールが実行される THEN システムは毎月末に月次分析を実行する SHALL
5. WHEN 市場が閉まっている時間の場合 THEN システムは次の市場開始時刻まで待機する SHALL
6. WHEN スケジュール実行中にエラーが発生した場合 THEN システムは次回の実行スケジュールを維持する SHALL

### 要件 6: エラーハンドリングとログ

**ユーザーストーリー:** システム管理者として、システムの動作状況を監視したいので、詳細なログとエラー処理機能が必要

#### 受入基準

1. WHEN システムが動作している場合 THEN システムは全ての重要な操作をログファイルに記録する SHALL
2. WHEN エラーが発生した場合 THEN システムは詳細なエラー情報とスタックトレースを記録する SHALL
3. WHEN ログファイルが設定サイズを超えた場合 THEN システムはログローテーションを実行する SHALL
4. WHEN 致命的なエラーが発生した場合 THEN システムは安全にシャットダウンし、管理者に通知する SHALL